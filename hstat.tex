\documentclass[3p]{elsarticle}
%\documentclass[a4paper]{amsart}
\usepackage{amsmath,amssymb,bm}
\usepackage{graphicx,url,verbatim,slashbox,multirow,hyperref}
\usepackage{microtype}
\usepackage{ucs}
\usepackage[utf8x]{inputenc}
\usepackage{siunitx}
%\usepackage[amssymb]{SIunits}

\setlength{\textwidth}{27pc}
\setlength{\textheight}{43pc}
%\linespread{1.6}

\newcommand{\EE}{\mathcal E}
\newcommand{\KK}{\mathsf K}
\newcommand{\PP}{\mathsf P}
\newcommand{\VV}{\bm V}
\newcommand{\R}{\mathbb R}
\newcommand{\ASM}{\mathrm{ASM}}
\newcommand{\RASM}{\mathrm{RASM}}
\newcommand{\bigO}{{\mathcal{O}}}
\newcommand{\abs}[1]{{\left\lvert #1 \right\rvert}}
\newcommand{\norm}[1]{{\left\lVert #1 \right\rVert}}
\newcommand{\tcolon}{{ : }}
\newcommand{\ip}[2]{{\left\langle #1, #2 \right\rangle}}

\DeclareMathOperator{\sspan}{span}
\DeclareSIUnit\year{a}
\sisetup{retain-unity-mantissa = false}

\journal{Journal of Computational Physics}

\begin{document}
\begin{frontmatter}
  \title{Achieving textbook multigrid efficiency for hydrostatic ice sheet flow}

  \author[vaw]{Jed Brown} \ead{brown@vaw.baug.ethz.ch}
  \author[mcs]{Barry Smith} \ead{bsmith@mcs.anl.gov}
  \author[kaust]{Aron Ahmadia} \ead{aron.ahmadia@kaust.edu.sa}

  \address[vaw]{Versuchsanstalt f\"ur Wasserbau, Hydrologie und Glaziologie (VAW), ETH Z\"urich, 8092     Z\"urich, Switzerland}
  \address[mcs]{Mathematics and Computer Science Division, Argonne National Laboratory, Argonne, IL     60439}
  \address[kaust]{KAUST-IBM Center for Deep Computing Research, Bldg \#1, Office 01-123,
    4700 King Abdullah University of Science and Technology,
    Thuwal Makkah 23955-6900,
    Kingdom of Saudi Arabia}

  \maketitle
  \begin{abstract}
    The hydrostatic equations for ice sheet flow offer improved fidelity compared to the shallow ice
    approximation and shelfy stream approximation popular in today's ice sheet models, but
    it presents a serious bottleneck because it requires the solution of a 3D nonlinear system, as
    opposed to the 2D system present in SSA.  This system is posed on high-aspect domains with strong
    anisotropy and variation in coefficients, making it very expensive to solve using the methods
    currently employed.  This paper presents a multigrid Newton-Krylov solver for the hydrostatic
    equations that demonstrates textbook multigrid efficiency (an order of magnitude reduction in
    residual per iteration and solution of the fine-level system in a small multiple of the cost of a
    residual evaluation).
  \end{abstract}
  \begin{keyword}
    hydrostatic, ice sheet, Newton-Krylov, multigrid, preconditioning
  \end{keyword}
  \thispagestyle{plain}
  \pagestyle{myheadings}
  \markboth{J. BROWN}{TME for hydrostatic ice sheet flow}
\end{frontmatter}

\section{Introduction}
The dynamic response of ice streams and outlet glaciers is poorly represented using the shallowness
assumptions inherent in the present generation of ice sheet models.  Accurate simulation of this
response is crucial for prediction of sea level rise and the inability of available models, based on
the shallow ice approximation (SIA)~\cite{hutter1983tgm} and shallow stream approximation
(SSA)~\cite{morland1987unconfined,weis1999theory}, to simulate these processes was cited as a major
deficiency in the IPCC AR4~\cite{ipcc2007ar4-syr}.

The hydrostatic equations were introduced by \cite{blatter1995vas} as a model of intermediate complexity between the full non-Newtonian Stokes system and the integrated SIA and SSA models.  A more precise analysis, including the limiting cases of fast and slow sliding, was given in \cite{schoof2010thin}.  Well-posedness was proven in \cite{colinge1999strongly} and approximation properties of finite element methods were analyzed in \cite{glowinski2003approximation,chow2004finite}.  The hydrostatic equations were used for transient simulation in \cite{pattyn2002tgr} and in 3D in \cite{pattyn2003ntd}, as well as subsequent work. Several models of this form were compared in \cite{pattyn2008beh}.

However, the use of hydrostatic equations in current models has been limited due to the cost of solving the 3D nonlinear system for velocity.  This cost comes from both slow convergence on the
nonlinearities (rheology and slip), and expensive linear solves using standard preconditioners such
as incomplete factorization and 1-level domain decomposition.  The poor linear solve performance is
attributable to the strong anisotropy and heterogeneity imposed by the rheology and geometry.

In the present work, we present a multigrid Newton-Krylov solver that demonstrates textbook
multigrid efficiency, characterized by convergence in a small multiple of the cost of a single
fine-level residual evaluation, and typically involving an order of magnitude reduction in residual
per multigrid (V or F) cycle.  The scheme converges quadratically on the nonlinearities, is rapidly
globalized using grid sequencing, is very robust to parameters and geometry, coarsens rapidly in
almost all cases, and exhibits excellent parallel scalability.  Our code is freely available as part
of the Portable Extensible Toolkit for Scientific computing (PETSc)~\cite{petsc-web-page}.

Section~\ref{sec:equations} presents the equations and discretization, Section~\ref{sec:solver}
describes the solver, and Section~\ref{sec:examples} demonstrates the performance and scalability
with numerical examples.

\section{Equations and discretization}\label{sec:equations}
The hydrostatic equations are obtained from the non-Newtonian Stokes equations in the limit where
horizontal derivatives of vertical velocity are small.  Neglecting these terms allows
incompressibility to be enforced implicitly by eliminating pressure and vertical velocity, leaving a
system involving only horizontal components of velocity.  See \cite{schoof2010thin} for a rigorous
derivation and asymptotic analysis.

Consider an ice domain $\Omega \subset \R^3$ lying between the bed $b \in C^1(\R^2)$ and surface $s
\in C^1(\R^2)$, with thickness $H = s-b$ bounded below by a positive constant\footnote{This singular
  limit is important in the case of grounded margins, but the present work does not pursue it.}  The
velocity $\bm u = (u,v) \in \bm V = \bm H^1(\Omega)$ satisfies conservation of momentum which,
omitting inertial terms as is standard for ice sheets, is given by
\begin{align}\label{eq:momentum}
  - \nabla\cdot \left[ \eta
  \begin{pmatrix}
    4 u_x + 2 v_y & u_y + v_x & u_z \\
    u_y + v_x & 2 u_x + 4 v_y & v_z
  \end{pmatrix} \right] + \rho g \nabla s & = 0
\end{align}
where
\begin{align}\label{eq:viscosity}
  \eta(\gamma) = \frac B 2 (\epsilon^2 + \gamma)^{\frac{1-n}{2n}}
\end{align}
is the nonlinear effective viscosity with regularization $\epsilon$ and
\begin{align*}
  \gamma = u_x^2 + v_y^2 + u_xv_y + \frac 1 4 (u_y+v_x)^2 + \frac 1 4 u_z^2 + \frac 1 4 v_z^2
\end{align*}
is the second invariant.  Ice sheet models typically take $n=3$ as the power law exponent.  Equation
\eqref{eq:momentum} is subject to natural boundary conditions at the free surface and either no-slip
$\bm u = 0$ or power-law slip with friction parameter
\begin{align*}
  \beta^2(\gamma_b) = \beta_0^2 (\epsilon_b^2 + \gamma_b)^{\frac{m-1}{2}}
\end{align*}
where $\gamma_b = \frac 1 2 (u^2 + v^2)$, $\epsilon_b$ is regularization, and $m \in (0,1]$ is the
exponent that produces Navier slip for $m=1$, Weertman~\cite{weertman1957sliding} sliding for
$m=1/n$, and Coulomb slip as $m \to 0$.  We defined $\epsilon$ and $\epsilon_b$ using a strain rate of $\SI{1e-5}{\per\year}$ and a slip velocity of $\SI{1}{\metre\per\year}$ respectively.

To discretize this system with a finite element method, we introduce the test functions $\bm \phi
\in \VV$ and integrate by parts to produce the weak form: find $\bm u \in \VV$ such that
\begin{align}\label{eq:weak}
  \int_\Omega \nabla\bm\phi \tcolon \eta \bm 1 \tcolon
  \begin{pmatrix}
    4 u_x + 2 v_y & u_y + v_x & u_z \\
    u_y + v_x & 2 u_x + 4 v_y & v_z
  \end{pmatrix} + \bm\phi \cdot\rho g \nabla s
  + \int_{\Gamma_{\text{bed}}} \bm \phi \cdot \beta^2(\abs{\bm u}^2/2) \bm u = 0
\end{align}
for all $\bm \phi \in \VV$ where $\Gamma_{\text{bed}}$ is the slip portion of the bed.

Equation \eqref{eq:weak} was discretized on a topologically structured hexahedral grid using $Q_1$ finite elements and standard 8-point Gauss quadrature.  Length, time, and mass units were chosen so that thickness, velocity, and driving stresses are $\bigO(1)$.  See Section~\ref{ssec:dirichlet} for details on the enforcement of Dirichlet boundary conditions.

The source code for our implementation is distributed as an example within PETSc~\cite{petsc-web-page} versions 3.1 and later\footnote{Upon unpacking the source, which can be downloaded from \href{http://mcs.anl.gov/petsc}{mcs.anl.gov/petsc}, see \texttt{src/snes/examples/tutorials/ex48.c}}.  Several generalizations of the tests from ISMIP-HOM~\cite{pattyn2008beh} are implemented, run with the option \texttt{-help} for a complete list of options.  Incidentally, our results for ``\SI{5}{\kilo\metre} test $C$'' in that paper (a slipperyness perturbation on a flat bed) agree to three significant figures with the ``Stokes'' results presented therein.  This is consistent with the asympotic analysis of \cite{schoof2010thin} which shows that slipperyness perturbations are not present in the leading order error terms for the hydrostatic equations (which is purely geometric), cf. \cite[Table~4,Figure~8]{pattyn2008beh} where the ensemble range is nearly as large as the mean.

\section{Solver and implementation}\label{sec:solver}
We begin by writing the discretization of \eqref{eq:weak} as an algebraic system $F(U) = 0$ with
Jacobian $J(U)$.  This nonlinear system is solved with a Newton iteration which requires an
(approximate) solution $\delta U$ of
\begin{align}\label{eq:newton-step}
  J(U)\delta U = -F(U) .
\end{align}
Newton methods are quadratically convergent in the terminal phase, but may converge very slowly or
not at all in the early phases.  Most applications of the present solver are in a time-stepping code
where the initial iterates start within the region of quadratic convergence, thus globalization
would rarely be a concern, but since a good initial iterate is not available in the present tests,
we use grid sequencing (solving the problem on a sequence of coarser grids) to produce an initial
iterate on the fine grid.

The Newton step \eqref{eq:newton-step} is solved by a Krylov method such as GMRES, for which the iteration count is highly dependent on quality of the preconditioner.  Since $J(U)$ is symmetric positive definite, methods such as conjugate gradients could be used, however this work always uses GMRES because it allows the use of nonsymmetric preconditioners such as F-cycle multigrid, and the iteration counts are always kept very low so that storage and restarts are not an issue.  As an SPD system, a wide variety of preconditioners are available, however, large viscosity contrasts and strong anisotropy cause most preconditioners to perform poorly. The rest of this section describes the methods used to produce a scalable algorithm in spite of these difficulties.

\subsection{Anisotropy}
The aspect ratio of outlet glaciers (the regions of ice sheets with greatest physical interest)
range from $\bigO(1)$ to over $100$.  The nonlinear constitutive relation \eqref{eq:viscosity}
produces several orders of magnitude variation in viscosity (usually with fastest variation in the
vertical) and the Newton linearization of \eqref{eq:weak} produces additional anisotropy,
effectively collapsing the conductivity tensor in the direction of the velocity gradient.

For systems with a priori known anisotropy, semi-coarsening has been successful for attaining
satisfactory multigrid performance even with weak smoothers like SOR, but semi-coarsening is
unattractive for two reasons.  Firstly, semi-coarsening in the vertical direction would necessitate
many levels because it only reduces the problem size by a factor of 2 on each coarsening (instead of
8 for isotropic coarsening), and the fully-coarsened problem would still be far too large for a
direct solver, necessitating further coarsening in the horizontal direction.  The presence of many
levels leads to more synchronization in parallel which is detrimental to scalability and makes
performance more sensitive to network latency.  Second, large viscosity contrasts and anisotropy
unaligned with the grid arise when friction parameter $\beta^2$ is not smooth, which is the standard
case when studying the migration of ice stream margins as the bed transitions from frozen (no-slip
or very high friction) to temperate and very slippery depending on subglacial hydrology.

In order to coarsen isotropically even on high-aspect domains, we order the unknowns so that columns
are contiguous with a natural block size of 2
(i.e. $\{u_{i,j,k},v_{i,j,k},u_{i,j,k+1},v_{i,j,k+1},\dotsc\}$ where $k$ is the index which is
increasing in the vertical direction) and not decomposed in parallel.  This decomposition is
reasonable since the number of vertical levels used in simulations is typically between 10 and 100,
and convenient since it is compatible with decompositions used by other climate model components.

With this ordering, zero-fill incomplete factorization effectively performs an exact solve of the
column since all the neglected fill (relative to an exact factorization) is caused by the coupling
with adjacent columns.  Pure line smoothers were also tried as a smoother on the finest level, but
robustness was significantly impacted and the memory benefits were deemed insufficient to pursue
further.

In scenarios with little sliding (frozen or sticky bed) and elements that are wide compared to the
ice thickness, a lubrication approximation known as the ``shallow ice approximation'' is valid,
allowing the velocity field to be determined locally from surface slope and a column integral.
Since incomplete factorization with column ordering provides nearly exact coupling in the vertical,
it is an effective preconditioner in such scenarios with no coarse level.  Indeed, with a typical
ice thickness of \SI{1}{\kilo\metre} resting on a frozen bed and elements \SI{5}{\kilo\metre} on
a side, block Jacobi with zero-fill incomplete Cholesky converges to relative tolerance of $10^{-5}$
in about 10 Krylov iterations independent of the horizontal extent of the domain (number of elements
in the horizontal), independent of the number of elements in the vertical, and independent of the
number of subdomains (provided they do not get too small, there is some degredation when subdomain
size approaches a single column).  However, none of these favorable performance characteristics
remain when the elements become small relative to the ice thickness or when the bed becomes
slippery, since the usual $\bigO\big((L/H)^2\big)$ condition number for second order elliptic problems
preconditioned by 1-level Schwarz methods with subdomains of size $H$ kicks in.

We have observed a weakness of incomplete Cholesky factorization that makes it nearly unusable as a
stand-alone preconditioner for this problem.  The Jacobian, including each subdomain problem in an
block Jacobi or additive Schwarz method, is symmetric positive definite, which guarantees that a
full Cholesky factorization can proceed with any ordering and will always find positive
pivots~\cite{trefethen1997numerical}.  This property does not hold for incomplete factorization as
discussed in~\cite{kershaw1978incomplete}.  Indeed, we find that strongly anisotropic problems
(whether the anisotropy is due to mesh aspect ratio or strong rheologic nonlinearity) produce
Jacobians for which incomplete Cholesky with any standard static pivoting (e.g. natural ordering,
reverse Cuthill-McKee, nested dissection) and any reasonably amount of fill (e.g. 0--8 levels)
produces negative pivots.  As is standard, these negative values can be ``shifted'' to a positive
value so that the algorithm can continue.  Empirically, this shifting causes both a local error that
may be cleaned up rapidly by the Krylov method and a nonlocal error that is disruptive to 1-level
domain decomposition methods, and increasing overlap or fill has limited benefit or is actually
harmful.  This effect is explored in Section~\ref{sec:1level}.

\subsection{Dirichlet boundary conditions}\label{ssec:dirichlet}
Multigrid is often sensitive to the enforcement of boundary conditions.  Ideally, Dirichlet
conditions would be completely removed from the solution space, but doing so complicates grid
management on structured grids, so instead we leave these degrees of freedom in the system but
decouple them from the other equations.  During residual evaluation in the finite element context,
this corresponds to evaluating integrals with the Dirichlet condition satisfied exactly, and setting
the residual on the Dirichlet nodes to be equal to a multiple of the current solution.  With this
scheme, all rows and columns of the Jacobian corresponding to Dirichlet nodes are zero except for a
single diagonal entry, thus the system retains symmetry and satisfaction of the Dirichlet conditions
does not interfere with solving the other equations.  For good multigrid performance, the diagonal
entry should be similar to the diagonal entry of the Jacobian for nearby nodes.  To ensure this, we
set the residual at Dirichlet nodes to
\begin{align}\label{eq:dirichlet-scale}
  f_u &= 2 \eta (4 h_yh_z/h_x + h_x h_z/h_y + h_x h_y/h_z) u \\
  f_v &= 2 \eta (h_yh_z/h_x + 4 h_x h_z/h_y + h_x h_y/h_z) u
\end{align}
where $h_x,h_y,h_z$ are the local element dimensions.  This scaling produces the same diagonal
entries that would appear if the domain was extended so that constant viscosity momentum equations
appeared at the formerly Dirichlet nodes.

\subsection{Throughput}
The most expensive operations are Jacobian assembly and sparse matrix kernels.  The former involves evaluation of transcendental functions and quadrature loops.  While transcendental functions take most of the time for residual evaluation, they are less significant than quadrature loops for assembly.  The quadrature loops were explicitly vectorized using SSE2 intrinsics which led to a 30\% speedup on Core 2 and Opteron architectures using both GNU and Intel compilers.  There was no manual vectorization for the Blue Gene/P results quoted in Section~\ref{sec:pscaling}.

The Jacobian is always symmetric positive definite and has a natural block size of 2, so we use a symmetric block format (PETSc's SBAIJ).  This format stores one column index per $2\times 2$ block in the upper triangular part of the matrix and therefore uses about half the storage of the nonsymmetric BAIJ format which in turn uses 25\% less memory than a scalar format (AIJ). Multiplication for symmetric storage requires twice as much parallel communication as nonsymmetric storage, albeit with the same number of messages. In return, the diagonal part of a parallel decomposition does twice as much work per matrix entry and thus achieves higher throughput in our tests, shown in Table~\ref{tab:sbaij}.

\begin{table}
  \centering\caption{Throughput (Mflop/s) for different matrix formats on Core 2 Duo (P8700) and Opteron 2356 (two sockets). \texttt{MatSolve} is a forward- and back-solve with incomplete Cholesky factors.  The AIJ format is using ``inodes'' which unrolls across consecutive rows with identical nonzero pattern (pairs in this case).}\label{tab:sbaij}
  \begin{tabular}{l|c|c|c|c|c|c}
    \multirow{2}{*}{\backslashbox{kernel}{format}} & \multicolumn{3}{c|}{Core 2, 1 thread} & \multicolumn{3}{c}{Opteron, 4 threads} \\
                      & AIJ & BAIJ & SBAIJ & AIJ  & BAIJ & SBAIJ \\ \hline
    \texttt{MatMult}  & 812 & 985  & 1507  & 2226 & 2918 & 3119  \\
    \texttt{MatSolve} & 718 & 957  & 955   & 1573 & 2869 & 2858  \\
  \end{tabular}
\end{table}

\section{Numerical examples}\label{sec:examples}
\subsection{Algorithmic Scalability}\label{sec:ascaling}
We consider three model problems inspired by the ISMIP-HOM~\cite{pattyn2008beh} tests.  All use surface $s(x,y) = -x\sin \alpha$ where $\alpha$ is the surface slope (the coordinate system is not rotated) and a bed similar to $b_A(x,y) = s(x,y) - \SI{1000}{\metre} + \SI{500}{\metre} \cdot \sin\hat{x}\sin\hat{y}$ for $(x,y) \in [0,L)^2$ with $\hat{x} = 2\pi x/L,\hat{y}=2\pi y/L$.  Test $X$ uses bed $b_X = b_A$ and stickyness parameter
\begin{align*}
  \beta_X^2(x,y) =
  \begin{cases}
    \SI{2000}{\pascal\year\per\metre} & \text{if } \abs{(\frac{2\pi x}{L},\frac{2\pi y}{L}) - (\pi,\pi)} < 1 \\
0 & \text{otherwise}
  \end{cases}
\end{align*}
which is free slip except for a sticky circle at the center of the domain which is not aligned with the grid.  This problem exhibits shear localization at the edges of the sticky region and is most extreme at high aspect ratio.  We choose $L = \SI{80}{\kilo\metre}$ and $\alpha = 0.05^\circ$.

Test $Y$ places a \SI{200}{\metre} tower with vertical walls on the top of each hump and uses an uncorrelated, but smoothely varying stickyness

\begin{gather*}
  b_Y(x,y) &=
  \begin{cases}
    b_A(x,y) & \text{if } b_A(x,y) < \SI{-700}{\metre} \\
    b_A(x,y) + \SI{200}{\metre} & \text{otherwise}
  \end{cases} \\
  \beta_Y^2 &= \SI{1000}{\Pascal\year\per\metre} \cdot (1 + \sin(\sqrt{16*r})/sqrt{1e-2 + 16r}\cos\frac{3\hat x}{2}\cos\frac{3\hat y}{2}
\end{gather*}


We compare to serial incomplete factorization and 1-level additive Schwarz since these methods are presently used by several groups to solve the hydrostatic equations.

\subsection{Parallel Scalability on Blue Gene/P}\label{sec:pscaling}
% Coarse level solves

\subsection{Incomplete factorization with 1-level additive Schwarz}\label{sec:1level}
%%%%%%%%%%%%%%%%%%  This section needs editing because I'm no longer sure about the shift
To explore the effect of incomplete factorization with shifting, we consider a $40\times 40\times
12$ element problem run on four processes and compare several 1-level domain decomposition methods
to our multigrid method.  This problem, which may be run with the options \texttt{-thi\_hom X
  -thi\_alpha 0.03 -thi\_L 80e3}, has a bumpy free-slip bed in most of the
$\SI{80}{\kilo\metre}\times \SI{80}{\kilo\metre}$ periodic domain and a very sticky circle in
the center, producing shear localization and thus strong anisotropy due to rheology in addition to
the mesh elements which have a nominal aspect ratio of 24 plus some additional distortion due to
topography.  This problem is challenging for the standard Newton iteration which requires 37
iterations and should be accompanied by grid sequencing for efficiency.  However, it takes the
problem through a range of nonlinearities and thus the number of Krylov iterations to solve with a
relative tolerance of $10^{-5}$, presented below, is a good test of the linear solver.

We first consider 1-level domain decomposition methods.  To keep iteration counts representative, we use full GMRES (no restart) with modified Gram-Schmidt orthogonalization (note that neither is practical for production use).  Conventional symmetric additive Schwarz is denoted $\ASM(k)$ where $k$ is the overlap and restricted additive Schwarz~\cite{cai1999restricted} is denoted $\RASM(k)$. In all cases where incomplete factorization was used for this problem, negative pivots appeared frequently and they were corrected using Manteuffel's shift algorithm~\cite{manteuffel1980incomplete}.  The average number of GMRES iterations per Newton is shown in Table~\ref{tab:1level}.  Note that increasing overlap has no benefit when incomplete subdomain solvers are used.

\begin{table}
  \centering\caption{Average number of GMRES iterations per Newton for 1-level domain decomposition with different overlap and fill.  Negative pivots appeared frequently in all cases where incomplete factorization was used.}\label{tab:1level}
  \begin{tabular}{l|c|c|c|c}
    \backslashbox{decomp.}{subdomain} & ICC(0) & ICC(1) & ICC(4) & Cholesky \\ \hline
    Block Jacobi & 367 & 315 & 220 & 97 \\
    $ASM(1)$     & 508 & 441 & 296 & 59 \\
    $RASM(1)$    & 368 & 306 & 190 & 52 \\
    $ASM(2)$     & 521 & 445 & 316 & 44 \\
    $RASM(2)$    & 365 & 305 & 189 & 38 \\
  \end{tabular}
\end{table}

A much easier problem which does not generate negative pivots can be run using the options \texttt{-thi\_hom Z -thi\_L 5e3}.  This problem has the same periodic geometry compressed to $\SI{5}{\kilo\metre}\times \SI{5}{\kilo\metre}$ and has smooth basal friction parameters.

We now compare to our 4-level V-cycle multigrid method with a coarse grid of $10\times 10\times 2$
elements which is semi-refined twice by a factor of 2 in the horizontal, then by a factor of 6 in
the vertical to reach the target $40\times 40\times 12$ grid.  Block Jacobi is used as the smoother
on levels, paired with either an exact or inexact subdomain solve.  A direct solver is always used
on the coarsest level and for the subdomain solvers on the next coarsest level (these problems very
small so the direct solve is cheap).  When a direct solve is used for the fine level subdomain
problems, an average of 8.9 Krylov iterations are needed per Newton.  Replacing these direct solves
with zero-fill incomplete Cholesky raises the iteration count to 9.6.  Increasing overlap from 0 to
1 on the finest level produces 9.4 for $\RASM(1)$ and 11.4 for $\ASM(1)$.  Using overlap on all
levels produces 9.6 iterations for $\RASM(1)$ and 34.8 for $\ASM(1)$.  We cannot explain why
symmetric additive Schwarz performs so poorly in this problem, but the other numbers are robust to
changes in resolution, spatial domain, and number of processes.

\section{Discussion}

\nonumber\section{Acknowledgments} This work was supported by Swiss National Science Foundation
Grant 200021-113503/1 and U.S. Department of Energy grant number {\bf ????}.

\bibliographystyle{model1-num-names}
\bibliography{flow}
\end{document}


% mpiexec.mpd -n 8 ./ex48 -M 16 -P 3 -thi_nlevels 6 -thi_hom x -thi_L 80e3 -pc_mg_type multiplicative -ksp_gmres_restart 60 -snes_monitor -ksp_monitor -ksp_converged_reason -mg_levels_pc_type asm -mg_levels_pc_asm_overlap 0 -da_refine_hierarchy_x 1,1,4,4,4 -da_refine_hierarchy_y 2,2,1,1,1 -da_refine_hierarchy_z 2,2,1,1,1 -dmmg_grid_sequence -mg_levels_1_sub_pc_type cholesky -mg_levels_2_sub_pc_type cholesky -thi_mat_type sbaij -log_summary
% Level 0 domain size (m)    8e+04 x    8e+04 x    1e+03, num elements  16x 16x  3 (     768), size (m) 5000 x 5000 x 500
% Level 1 domain size (m)    8e+04 x    8e+04 x    1e+03, num elements  32x 32x  3 (    3072), size (m) 2500 x 2500 x 500
% Level 2 domain size (m)    8e+04 x    8e+04 x    1e+03, num elements  64x 64x  3 (   12288), size (m) 1250 x 1250 x 500
% Level 3 domain size (m)    8e+04 x    8e+04 x    1e+03, num elements  64x 64x  9 (   36864), size (m) 1250 x 1250 x 125
% Level 4 domain size (m)    8e+04 x    8e+04 x    1e+03, num elements  64x 64x 33 (  135168), size (m) 1250 x 1250 x 31.25
% Level 5 domain size (m)    8e+04 x    8e+04 x    1e+03, num elements  64x 64x129 (  528384), size (m) 1250 x 1250 x 7.8125
